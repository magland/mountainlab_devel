function ms_view_templates(templates,opts)

if (nargin<1) test_ms_view_templates; return; end;

if (nargin<2) opts=struct;

vspread=max(abs(templates(:)));

[M,T,K]=size(templates);

colors={...
    [0.1562,0.1562,0.1562],... %"#282828"
    [0.2500,0.1250,0.1250],... %"#402020"
    [0.1250,0.2500,0.1250],... %"#204020"
    [0.1250,0.1250,0.4375],... %"#202070"
};

y_offset=0;
Tpad=20;
for m=1:M
    tmp=cat(2,templates(m,:,:),ones(1,Tpad,K)*inf);
    tmp=reshape(tmp,1,(T+Tpad)*K);
    hh=plot(tmp+y_offset); hold on;
    set(hh,'Color',colors{1+mod(m-1,length(colors))});
    y_offset=y_offset-vspread;
end;

if isfield(opts,'

Tmargin=2*T+Tpad;
vmargin=vspread*2;
xlim([-Tmargin,Tmargin+(T+Tpad)*K+Tmargin]);
ylim([-vspread*(M-1)-vmargin,vmargin]);
set(gca,'xtick',[]); set(gca,'ytick',[]);
set(gca,'position',[0,0,1,1]);

label_color=[0.7,0.7,0.7];

for k=1:K
    hh=text((T+Tpad)*(k-1)+T/2,vspread/2,sprintf('%d',k));
    set(hh,'HorizontalAlignment','center');
    set(hh,'VerticalAlignment','bottom');
    set(hh,'FontSize',8);
    set(hh,'Color',label_color);
end;

for k=1:K
    hh=text((T+Tpad)*(k-1)+T/2,-vspread*(M-1)-vspread/2,sprintf('%d',k));
    set(hh,'HorizontalAlignment','center');
    set(hh,'VerticalAlignment','top');
    set(hh,'FontSize',8);
    set(hh,'Color',label_color);
end;

for m=1:M
    hh=text(-Tpad,-(m-1)*vspread,sprintf('%d',m));
    set(hh,'HorizontalAlignment','right');
    set(hh,'VerticalAlignment','middle');
    set(hh,'FontSize',8);
    set(hh,'Color',label_color);
end;

end

function test_ms_view_templates

mfile_path=fileparts(mfilename('fullpath'));
templates=readmda(sprintf('%s/../example_data/templates0.mda',mfile_path));
figure;
ms_view_templates(templates);

end

